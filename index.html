<!DOCTYPE html>
<html>
<head>
	
	<title>Mobile tutorial - Leaflet</title>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	
	<link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js" integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og==" crossorigin=""></script>
	<script src="https://unpkg.com/papaparse@5.1.0/papaparse.min.js"></script>
	
	<link rel="stylesheet" href="plugins/sidebar.min.css"/>
	<script src="plugins/sidebar.min.js"></script>
	<script src="plugins/leaflet-slider.min.js"></script>

	<!-- **************** jquery ******************* -->
	<script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>	
	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js" integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU=" crossorigin="anonymous"></script>	
	<link rel="stylesheet" href="plugins/jquery-ui.css"/>

	<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
	<style>
		html, body {
			height: 100%;
			width: 100%;
			box-sizing: border-box;
			margin: 0;
			font: 10pt "Helvetica Neue", Arial, Helvetica, sans-serif;
		}
		#map {
			width: 600px;
			height: 400px;
			margin-left: 0;
		}
		.sidebar-tabs {
			box-shadow: 0 0 3px #888;
		}
		#sidebar {
			border: none;
		}

		#sidebar.collapsed {
			boder: none;
		}
		
		.icon {
			height: 90%;
			width: 90%;
			border-radius: 3px;
		}
		#filter {
			height: 20px;
			width: 20px;
		}
		.filter-buttons-container {
			top: 26px;
			width: 116px;
		}

		.weather-buttons-container {
			top: 26px;
			width: 116px;
		}

		.buttons-container {
			background-color: white;
			box-shadow: 2px 1px 3px rgba(36, 30, 30, 0.349);
			border-radius: 100px;
			padding: 0 20px 0px 60px;
			display: flex;
			flex-flow: row nowrap;
			justify-content: flex-start;
			position: absolute;
			left: -45px;
		}
		.filter-button {
			margin: 4px;
			min-width: 33px;
			height: 33px;
			background-color: #6cd86cd0;
			border-radius: 2px;
		}
		.disabled-layer-button {
			background-color: transparent !important;
			box-shadow: 0 0 0 transparent;
		}
		li {
    		list-style-type: none;
		}
		.transparent-background {
			background-color: transparent;
		}
		
		
		.leaflet-popup-content-wrapper {
			background: rgb(111, 51, 51);
			color: rgb(255,255,255);
			text-align: center;
			font-family: 'Times New Roman', serif;
			font-size:16px;
			box-shadow: 0 3px 14px rgba(0,0,0,0.4);
			
		}
		.leaflet-popup-tip {
			background: rgb(111, 51, 51);
		}
	
	</style>

	<style>body { padding: 0; margin: 0; } #map { height: 100%; width: 100vw; }</style>
</head>
<body>
	
	
	<div id="sidebar" class="sidebar collapsed">
        <!-- Nav tabs -->
        <div class="sidebar-tabs">
            <ul role="tablist">
                <li><a href="#home" role="tab"><i class="fa fa-bars"></i></a></li>
                <li><a href="#filters" role="tab"><img src="image/img1_pm10.png" class="icon"/></a></li>
                <li><a href="#weather" role="tab"><img src="image/img_meteo0.png" class="icon"/></a></li>
            </ul>

            <ul role="tablist">
                <li><a href="#settings" role="tab"><i class="fa fa-gear"></i></a></li>
            </ul>
        </div>

        <!-- Tab panes -->
        <div class="sidebar-content transparent-background">
            <div class="sidebar-pane" id="filters">
				<ul class="buttons-container filter-buttons-container">
					<li class="filter-button"  id="pm10"><a href="#pm10"><img class="icon" src="image/img1_pm10.png"/></a></li>
					<li class="filter-button" id="pm25"><a href="#pm25"><img class="icon" src="image/img2_pm2_5.png"/></a></li>
					<li class="filter-button" id="pm1"><a href="#pm1"><img class="icon" src="image/img3_pm1.png"/></a></li>
				</ul>
            </div>
            <div class="sidebar-pane" id="weather">
				<ul class="buttons-container weather-buttons-container">
					<li class="weather-button" id="wind"><a><img class="icon" src="image/img_meteo1_vent.png"/></a></li>
					<li class="weather-button" id="temp"><a><img class="icon" src="image/img_meteo2_temperature.png"/></a></li>
				</ul>
			</div>	
			<div class="sidebar-pane" id="settings">
                <h1 class="sidebar-header">Settings<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
            </div>
        </div>
    </div>

	<div id='map' class='sidebar-map'></div>

	<div class="leaflet-top leaflet-right" style="margin-right: 10px; margin-top: 10px;">
		<img src="image/temperature.svg" width="60" height="65">
	</div>
	
	
	<div class="leaflet-top leaflet-right" style="margin-right: 55px; margin-top: 10px;  font-size: 27px;">
			<p id="p">15.5 &#176;C</p>
	</div>
	
	
	
	<div class="leaflet-top leaflet-right" style="margin-right: 10px; margin-top: 70px;">
		<img src="image/weather.svg" width="60" height="65">
	</div>
		
	<script>	



	//My lolilolDB
	var dataDynamic = '[{"Jour":"2019-10-13","Heure":"10:15:05","PM1":8,"PM2.5":12,"PM10":26,"Latitude":48.580855,"Longitude":7.762535},{"Jour":"2019-10-13","Heure":"10:15:20","PM1":12,"PM2.5":16,"PM10":30,"Latitude":48.581131,"Longitude":7.76269},{"Jour":"2019-10-13","Heure":"10:15:35","PM1":16,"PM2.5":20,"PM10":32,"Latitude":48.581312,"Longitude":7.762763},{"Jour":"2019-10-13","Heure":"10:15:50","PM1":17,"PM2.5":22,"PM10":36,"Latitude":48.581536,"Longitude":7.762907},{"Jour":"2019-10-13","Heure":"10:16:05","PM1":15,"PM2.5":18,"PM10":32,"Latitude":48.581714,"Longitude":7.762985},{"Jour":"2019-10-13","Heure":"10:16:20","PM1":12,"PM2.5":14,"PM10":28,"Latitude":48.581897,"Longitude":7.763071},{"Jour":"2019-10-13","Heure":"10:16:35","PM1":8,"PM2.5":10,"PM10":24,"Latitude":48.582174,"Longitude":7.763212},{"Jour":"2019-10-13","Heure":"10:16:50","PM1":7,"PM2.5":9,"PM10":20,"Latitude":48.58231,"Longitude":7.763255},{"Jour":"2019-10-13","Heure":"10:17:05","PM1":5,"PM2.5":8,"PM10":18,"Latitude":48.582277,"Longitude":7.763439},{"Jour":"2019-10-13","Heure":"10:17:20","PM1":7,"PM2.5":10,"PM10":22,"Latitude":48.582328,"Longitude":7.763623},{"Jour":"2019-10-13","Heure":"10:17:35","PM1":9,"PM2.5":11,"PM10":24,"Latitude":48.582441,"Longitude":7.763843},{"Jour":"2019-10-13","Heure":"10:17:50","PM1":10,"PM2.5":15,"PM10":29,"Latitude":48.582614,"Longitude":7.763907},{"Jour":"2019-10-13","Heure":"10:18:05","PM1":12,"PM2.5":18,"PM10":32,"Latitude":48.582586,"Longitude":7.764162},{"Jour":"2019-10-13","Heure":"10:18:20","PM1":14,"PM2.5":21,"PM10":34,"Latitude":48.58253,"Longitude":7.764375},{"Jour":"2019-10-13","Heure":"10:18:35","PM1":13,"PM2.5":20,"PM10":32,"Latitude":48.582647,"Longitude":7.76468},{"Jour":"2019-10-13","Heure":"10:18:50","PM1":13,"PM2.5":19,"PM10":31,"Latitude":48.582591,"Longitude":7.764878},{"Jour":"2019-10-13","Heure":"10:19:05","PM1":12,"PM2.5":18,"PM10":29,"Latitude":48.582539,"Longitude":7.76514},{"Jour":"2019-10-13","Heure":"10:19:20","PM1":10,"PM2.5":15,"PM10":27,"Latitude":48.582685,"Longitude":7.765225},{"Jour":"2019-10-13","Heure":"10:19:35","PM1":8,"PM2.5":10,"PM10":24,"Latitude":48.582797,"Longitude":7.765296},{"Jour":"2019-10-13","Heure":"10:19:50","PM1":7,"PM2.5":9,"PM10":22,"Latitude":48.582933,"Longitude":7.76536},{"Jour":"2019-10-13","Heure":"10:20:05","PM1":8,"PM2.5":9,"PM10":21,"Latitude":48.583069,"Longitude":7.765481}]';


	var map = L.map('map', {zoomControl: false}).fitWorld();
	L.control.zoom({position: 'bottomright'}).addTo(map);

	L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
		maxZoom: 18,
		attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
			'<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
			'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
		id: 'mapbox.streets'
	}).addTo(map);

	var greenMarker = L.icon({
		iconUrl: 'image/img4_marqueur_vert.png',
		iconSize:     [40, 40], // size of the icon
		iconAnchor:   [12, 40], // point of the icon which will correspond to marker's location
		popupAnchor:  [0, -43] // point from which the popup should open relative to the iconAnchor
	});

	function onLocationFound(e) {
		var radius = e.accuracy / 2;

		L.marker(e.latlng, {icon: greenMarker}).addTo(map)
			.bindPopup("You are within " + radius + " meters from this point");

		L.circle(e.latlng, radius).addTo(map);
	}

	function onLocationError(e) {
		alert(e.message);
	}

	map.on('locationfound', onLocationFound);
	map.on('locationerror', onLocationError);
	
	//Marker part  DEV ONLY
	//https://www.papaparse.com/
	
	
		
	var greenIcon = L.icon({
		iconUrl: 'leaf-green.png',
		shadowUrl: 'leaf-shadow.png',

		iconSize:     [38, 95], // size of the icon
		shadowSize:   [50, 64], // size of the shadow
		iconAnchor:   [22, 94], // point of the icon which will correspond to marker's location
		shadowAnchor: [4, 62],  // the same for the shadow
		popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor
	});

	
	
	
	
	//-----------------------------Add dynamic points   
	const obj = JSON.parse(dataDynamic);
	var i;
	var polylineArr = [];
	for (i = 0; i < obj.length ; i++) {
		var dateString = obj[i].Jour + ' ' + obj[i].Heure;
		
		var strongness;
		
		strongness = (obj[i].PM1/15);
		
		
		
		var polylinePointsShadow = [
			[obj[i].Latitude, obj[i].Longitude],
			[obj[i].Latitude+0.0001*strongness, obj[i].Longitude+0.0002*strongness]
		];            
		  
		var polylineShadow = L.polyline(polylinePointsShadow).setStyle({weight:6,color: 'grey',opacity: 0.4 });
		var polylinePoints = [
			[obj[i].Latitude, obj[i].Longitude],
			[obj[i].Latitude+0.0005*strongness, obj[i].Longitude]
		];
		
		var colorR = obj[i].PM1.toString(16);
		var colorV = (15-obj[i].PM1).toString(16).replace("-", "");
		
		var finalColor = '#'.concat(colorR).concat(colorV).concat('0');
		console.log(obj[i].Jour + ' ' + obj[i].Heure);
		var polyline = L.polyline(polylinePoints).setStyle({weight:6,color: finalColor,opacity: 1 }).bindPopup('<p>date<br />hour<br />values of pollution</p>');
		
		var polylinegroup = L.layerGroup([polylineShadow, polyline], {time: dateString});
		polylineArr.push(polylinegroup);

	}	
	var polylineLayer = L.layerGroup(polylineArr).addTo(map);
	//END----------------------------- add points

	// Sidebar
	const standards = ['eu', 'oms'];

	var state = {
		toggle: function(field) {
			this[field] = !this[field]; 
			console.log(field.toString(), "=", this[field].toString());
		},
		isSet: function(field) {return this[field]},
		'pm1': true,
		'pm25': true,
		'pm10': true,
		'no2': false,
		'standard': standards[0]
	};

	var sidebar = L.control.sidebar('sidebar').addTo(map);
 
	$('#pm10').click(function() {
		if (state.isSet('pm10')) {
			$(this).addClass('disabled-layer-button');
		} else {
			$(this).removeClass('disabled-layer-button');
		}
		state.toggle('pm10');
	});
	$('#pm25').click(function() {
		if (state.isSet('pm25')) {
			$(this).addClass('disabled-layer-button');
		} else {
			$(this).removeClass('disabled-layer-button');
		}
		state.toggle('pm25');
	});
	$('#pm1').click(function() {
		if (state.isSet('pm1')) {
			$(this).addClass('disabled-layer-button');
		} else {
			$(this).removeClass('disabled-layer-button');
		}
		state.toggle('pm1');
	});
	// END sidebar


	// Time slider
	var sliderControl = L.control.sliderControl({position: "topright", layer: polylineLayer, follow: 6});
	map.addControl(sliderControl);
	sliderControl.startSlider();
	// END time slider

	map.locate({setView: true, maxZoom: 16});



</script>



</body>
</html>