<!DOCTYPE html>
<html>
<head>
	
	<title>Mobile tutorial - Leaflet</title>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	
	<link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js" integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og==" crossorigin=""></script>
	<script src="https://unpkg.com/papaparse@5.1.0/papaparse.min.js"></script>
	
	<link rel="stylesheet" href="sidebar/sidebar.min.css"/>
	<script src="sidebar/sidebar.min.js"></script>
	<script
			  src="https://code.jquery.com/jquery-3.4.1.min.js"
			  integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
			  crossorigin="anonymous"></script>	
	
	<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
	<style>
		html, body {
			height: 100%;
			width: 100%;
			box-sizing: border-box;
			margin: 0;
			font: 10pt "Helvetica Neue", Arial, Helvetica, sans-serif;
		}
		#map {
			width: 600px;
			height: 400px;
			margin-left: 0;
		}
		
		.disabledLayerButton {
			background-color: lightgray!important;
			color: gray!important;
		}
		.layerButton {
			display: inline-block;
			border-radius: 60px;
			box-shadow: 0px 0px 2px #888;
			font-size: 8px;
			padding: 5px;
			text-decoration: none;
		}
		#pm10 {
			background-color: blueviolet;
			color: white;
		}
		.filter-buttons {
			display: flex;
			flex-flow: row nowrap;
			justify-content: flex-start;
			padding: 0;
			position: absolute;
			top: 38px;
		}
		.filter-button {
			margin: 4px;
			min-width: 20px;
		}
		li {
    		list-style-type: none;
		}
		.transparent-background {
			background-color: transparent;
		}
		
		
	     .leaflet-popup-content-wrapper {
			background: rgb(111, 51, 51);
			color: rgb(255,255,255);
			text-align: center;
			font-family: 'Times New Roman', serif;
			font-size:16px;
			box-shadow: 0 3px 14px rgba(0,0,0,0.4);
			
		}
		.leaflet-popup-tip {
			background: rgb(111, 51, 51);
		}
	
	</style>

	<style>body { padding: 0; margin: 0; } #map { height: 100%; width: 100vw; }</style>
</head>
<body>
	
	
	<div id="sidebar" class="sidebar collapsed">
        <!-- Nav tabs -->
        <div class="sidebar-tabs">
            <ul role="tablist">
                <li><a href="#home" role="tab"><i class="fa fa-bars"></i></a></li>
                <!-- <li class="disabled"><a id="pm10" href="#pm10" role="tab" class="layerButton"><i>PM10</i></a></li> -->
                <li><a href="#filters" role="tab"><i class="fa fa-filter"></i></a></li>
                <li><a href="https://github.com/Turbo87/sidebar-v2" role="tab" target="_blank"><i class="fa fa-github"></i></a></li>
            </ul>

            <ul role="tablist">
                <li><a href="#settings" role="tab"><i class="fa fa-gear"></i></a></li>
            </ul>
        </div>

        <!-- Tab panes -->
        <div class="sidebar-content transparent-background">
            <div class="sidebar-pane" id="home">
                <h1 class="sidebar-header">
                    sidebar-v2
                    <span class="sidebar-close"><i class="fa fa-caret-left"></i></span>
                </h1>
            </div>
            <div class="sidebar-pane" id="filters">
				<ul class="filter-buttons">
					<li class="filter-button"><a id="pm10" href="#pm10" class="layerButton"><i>PM10</i></a></li>
					<li class="filter-button"><a id="pm10" href="#pm10" class="layerButton"><i>PM10</i></a></li>
					<li class="filter-button"><a id="pm10" href="#pm10" class="layerButton"><i>PM10</i></a></li>
				</ul>
            </div>
            <div class="sidebar-pane" id="filters">
				<ul class="filter-buttons">
					<li class="filter-button"><a id="pm10" href="#pm10" class="layerButton"><i>PM10</i></a></li>
					<li class="filter-button"><a id="pm10" href="#pm10" class="layerButton"><i>PM10</i></a></li>
					<li class="filter-button"><a id="pm10" href="#pm10" class="layerButton"><i>PM10</i></a></li>
				</ul>
            </div>


			<div class="sidebar-pane" id="settings">
                <h1 class="sidebar-header">Settings<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
            </div>
        </div>
    </div>

	<div id='map' class='sidebar-map'></div>

	<div class="leaflet-top leaflet-right" style="margin-right: 10px; margin-top: 10px;">
			<img src="image/temperature.svg" width="40" height="45">
		</div>
		
		
		<div class="leaflet-top leaflet-right" style="margin-right: 10px; margin-top: 60px;">
			<img src="image/weather.svg" width="40" height="45">
		</div>
		
<script>	



	//My lolilolDB
	var data = '[{"Jour":"2019-10-07","Heure":"10:30:00","PM1":2,"PM2.5":4,"PM10":7,"Latitude":48.5989635,"Longitude":7.7424285},{"Jour":"2019-10-07","Heure":"10:30:15","PM1":3,"PM2.5":9,"PM10":15,"Latitude":48.599227,"Longitude":7.7425905},{"Jour":"2019-10-07","Heure":"10:30:30","PM1":3,"PM2.5":9,"PM10":15,"Latitude":48.599787,"Longitude":7.743076},{"Jour":"2019-10-07","Heure":"10:30:45","PM1":4,"PM2.5":12,"PM10":20,"Latitude":48.6001045,"Longitude":7.7433635},{"Jour":"2019-10-07","Heure":"10:31:00","PM1":4,"PM2.5":12,"PM10":20,"Latitude":48.600805,"Longitude":7.7441735},{"Jour":"2019-10-07","Heure":"10:31:15","PM1":5,"PM2.5":15,"PM10":26,"Latitude":48.601552,"Longitude":7.744991},{"Jour":"2019-10-07","Heure":"10:31:30","PM1":6,"PM2.5":18,"PM10":31,"Latitude":48.602008,"Longitude":7.7453725},{"Jour":"2019-10-07","Heure":"10:31:45","PM1":7,"PM2.5":21,"PM10":36,"Latitude":48.602382,"Longitude":7.7456915},{"Jour":"2019-10-07","Heure":"10:32:00","PM1":6,"PM2.5":18,"PM10":31,"Latitude":48.6031325,"Longitude":7.7462945},{"Jour":"2019-10-07","Heure":"10:32:15","PM1":6,"PM2.5":18,"PM10":31,"Latitude":48.603881,"Longitude":7.7468995},{"Jour":"2019-10-07","Heure":"10:32:30","PM1":5,"PM2.5":15,"PM10":26,"Latitude":48.6043765,"Longitude":7.747312},{"Jour":"2019-10-07","Heure":"10:32:45","PM1":5,"PM2.5":15,"PM10":26,"Latitude":48.604956,"Longitude":7.747782},{"Jour":"2019-10-07","Heure":"10:33:00","PM1":4,"PM2.5":12,"PM10":20,"Latitude":48.6055315,"Longitude":7.748259},{"Jour":"2019-10-07","Heure":"10:33:15","PM1":4,"PM2.5":12,"PM10":20,"Latitude":48.606239,"Longitude":7.748811},{"Jour":"2019-10-07","Heure":"10:33:30","PM1":5,"PM2.5":15,"PM10":26,"Latitude":48.606777,"Longitude":7.749226},{"Jour":"2019-10-07","Heure":"10:33:45","PM1":5,"PM2.5":15,"PM10":26,"Latitude":48.6074885,"Longitude":7.7496735},{"Jour":"2019-10-07","Heure":"10:33:30","PM1":4,"PM2.5":12,"PM10":20,"Latitude":48.6011315,"Longitude":7.7443935},{"Jour":"2019-10-07","Heure":"10:33:45","PM1":4,"PM2.5":12,"PM10":20,"Latitude":48.6013355,"Longitude":7.7435},{"Jour":"2019-10-07","Heure":"10:34:00","PM1":5,"PM2.5":15,"PM10":26,"Latitude":48.601535,"Longitude":7.7427375},{"Jour":"2019-10-07","Heure":"10:34:15","PM1":5,"PM2.5":15,"PM10":26,"Latitude":48.601857,"Longitude":7.74167},{"Jour":"2019-10-07","Heure":"10:31:00","PM1":2,"PM2.5":6,"PM10":10,"Latitude":48.6020965,"Longitude":7.7453875},{"Jour":"2019-10-07","Heure":"10:31:15","PM1":3,"PM2.5":9,"PM10":15,"Latitude":48.602205,"Longitude":7.744777},{"Jour":"2019-10-07","Heure":"10:31:30","PM1":4,"PM2.5":12,"PM10":20,"Latitude":48.602377,"Longitude":7.743852},{"Jour":"2019-10-07","Heure":"10:31:45","PM1":5,"PM2.5":15,"PM10":26,"Latitude":48.6025315,"Longitude":7.742866},{"Jour":"2019-10-07","Heure":"10:32:00","PM1":6,"PM2.5":18,"PM10":31,"Latitude":48.602657,"Longitude":7.742094},{"Jour":"2019-10-07","Heure":"10:31:15","PM1":3,"PM2.5":9,"PM10":15,"Latitude":48.59971996,"Longitude":7.743101847},{"Jour":"2019-10-07","Heure":"10:31:30","PM1":3,"PM2.5":9,"PM10":15,"Latitude":48.60058291,"Longitude":7.743981074},{"Jour":"2019-10-07","Heure":"10:31:45","PM1":4,"PM2.5":12,"PM10":20,"Latitude":48.6007706,"Longitude":7.744234157},{"Jour":"2019-10-07","Heure":"10:32:00","PM1":4,"PM2.5":12,"PM10":20,"Latitude":48.60124455,"Longitude":7.744802786},{"Jour":"2019-10-07","Heure":"10:32:15","PM1":5,"PM2.5":15,"PM10":26,"Latitude":48.60141554,"Longitude":7.7449664},{"Jour":"2019-10-07","Heure":"10:32:30","PM1":5,"PM2.5":15,"PM10":26,"Latitude":48.60185755,"Longitude":7.745395554},{"Jour":"2019-10-07","Heure":"10:32:45","PM1":4,"PM2.5":12,"PM10":20,"Latitude":48.60216482,"Longitude":7.745626867},{"Jour":"2019-10-07","Heure":"10:33:00","PM1":3,"PM2.5":9,"PM10":15,"Latitude":48.60236631,"Longitude":7.745790482},{"Jour":"2019-10-07","Heure":"10:33:15","PM1":2,"PM2.5":6,"PM10":10,"Latitude":48.60265719,"Longitude":7.745962143},{"Jour":"2019-10-07","Heure":"10:33:30","PM1":1,"PM2.5":3,"PM10":5,"Latitude":48.60275936,"Longitude":7.745637596},{"Jour":"2019-10-07","Heure":"10:33:45","PM1":1,"PM2.5":3,"PM10":5,"Latitude":48.60280831,"Longitude":7.745248675},{"Jour":"2019-10-07","Heure":"10:33:15","PM1":4,"PM2.5":12,"PM10":20,"Latitude":48.604435,"Longitude":7.7474915},{"Jour":"2019-10-07","Heure":"10:33:30","PM1":5,"PM2.5":15,"PM10":26,"Latitude":48.6042745,"Longitude":7.747847},{"Jour":"2019-10-07","Heure":"10:33:45","PM1":6,"PM2.5":18,"PM10":31,"Latitude":48.604172,"Longitude":7.7480915},{"Jour":"2019-10-07","Heure":"10:34:00","PM1":8,"PM2.5":24,"PM10":41,"Latitude":48.6041065,"Longitude":7.7484365},{"Jour":"2019-10-07","Heure":"10:34:15","PM1":10,"PM2.5":30,"PM10":51,"Latitude":48.60402,"Longitude":7.7489545},{"Jour":"2019-10-07","Heure":"10:34:30","PM1":15,"PM2.5":45,"PM10":77,"Latitude":48.603968,"Longitude":7.7494145},{"Jour":"2019-10-07","Heure":"10:34:45","PM1":14,"PM2.5":42,"PM10":71,"Latitude":48.603956,"Longitude":7.7497715},{"Jour":"2019-10-07","Heure":"10:35:00","PM1":13,"PM2.5":39,"PM10":66,"Latitude":48.6039675,"Longitude":7.750076},{"Jour":"2019-10-07","Heure":"10:35:15","PM1":12,"PM2.5":36,"PM10":61,"Latitude":48.6040425,"Longitude":7.7505685}]';


	var map = L.map('map', {zoomControl: false}).fitWorld();
	L.control.zoom({position: 'bottomright'}).addTo(map);

	L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
		maxZoom: 18,
		attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
			'<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
			'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
		id: 'mapbox.streets'
	}).addTo(map);



	function onLocationFound(e) {
		var radius = e.accuracy / 2;

		L.marker(e.latlng).addTo(map)
			.bindPopup("You are within " + radius + " meters from this point");

		L.circle(e.latlng, radius).addTo(map);
	}

	function onLocationError(e) {
		alert(e.message);
	}

	map.on('locationfound', onLocationFound);
	map.on('locationerror', onLocationError);
	
	//Marker part  DEV ONLY
	//https://www.papaparse.com/
	
	
		
	var greenIcon = L.icon({
		iconUrl: 'leaf-green.png',
		shadowUrl: 'leaf-shadow.png',

		iconSize:     [38, 95], // size of the icon
		shadowSize:   [50, 64], // size of the shadow
		iconAnchor:   [22, 94], // point of the icon which will correspond to marker's location
		shadowAnchor: [4, 62],  // the same for the shadow
		popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor
	});

	

	//----------------------------- Marker part
	//L.marker([48.582305, 7.764928], {icon: greenIcon}).addTo(map).bindPopup('<p>date<br />hour<br />values of pollution</p>').openPopup();
	
	//END----------------------------- marker part
	
	
	
	
	//-----------------------------Add points   
	const obj = JSON.parse(data);
	var i;
	for (i = 0; i < obj.length ; i++) {
		//console.log(obj[i].Latitude); 
		//L.marker([obj[i].Latitude, obj[i].Longitude], {icon: greenIcon}).addTo(map).bindPopup('<p>date<br />hour<br />values of pollution</p>');
		
		var strongness;
		
		strongness=obj[i].PM1/15 //0-10
		//obj[i].PM2.5 //?? ^^
		//obj[i].PM10
		
		
		
		var polylinePointsShadow = [
			[obj[i].Latitude, obj[i].Longitude],
			[obj[i].Latitude+0.0001*strongness, obj[i].Longitude+0.0002*strongness]
		];            
		  
		var polylineShadow = L.polyline(polylinePointsShadow).setStyle({weight:4,color: 'grey',opacity: 0.4 }).addTo(map); 
		
		var polylinePoints = [
			[obj[i].Latitude, obj[i].Longitude],
			[obj[i].Latitude+0.0005*strongness, obj[i].Longitude]
		];  
		
		var colorR = obj[i].PM1.toString(16);
		var colorV = (15-obj[i].PM1).toString(16).replace("-", "");;
		
		var finalColor = '#'.concat(colorR).concat(colorV).concat('0');
		console.log(finalColor); 
		
		var polyline = L.polyline(polylinePoints).setStyle({weight:4,color: finalColor,opacity: 1 }).addTo(map).bindPopup('<p>date<br />hour<br />values of pollution</p>');
		

	}	
	//END----------------------------- add points

	// Sidebar
	const standards = ['eu', 'oms'];

	var state = {
		toggle: function(field) {
			this[field] = !this[field]; 
			console.log(field.toString(), "=", this[field].toString());
		},
		isSet: function(field) {return this[field]},
		'pm1': true,
		'pm25': true,
		'pm10': true,
		'no2': false,
		'standard': standards[0]
	};

	var sidebar = L.control.sidebar('sidebar').addTo(map);
 
	$('#pm10').click(function() {
		if (state.isSet('pm10')) {
			$(this).addClass('disabledLayerButton');
		} else {
			$(this).removeClass('disabledLayerButton');
		}
		state.toggle('pm10');
	});
	// END sidebar


	map.locate({setView: true, maxZoom: 16});


	
</script>



</body>
</html>